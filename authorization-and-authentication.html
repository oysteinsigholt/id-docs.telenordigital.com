<!doctype html>
<html class="docs-html">
<head>
  <meta charset="utf-8">
  <title>Authorization &amp; authentication - CONNECT ID Documentation</title>
    <meta name="description" content="Detailed information on authorization and authentication">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Twitter Card data -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Authorization &amp; authentication - CONNECT ID Documentation">
  <meta name="twitter:description" content="Detailed information on authorization and authentication">
  <meta name="twitter:image" content="https://telenordigital.github.io/id-docs.telenordigital.com/img/og_image.jpg">

  <!-- Open Graph data -->
  <meta property="og:title" content="Authorization &amp; authentication - CONNECT ID Documentation" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://telenordigital.github.io/id-docs.telenordigital.com/authorization-and-authentication.html" />
  <meta property="og:image" content="https://telenordigital.github.io/id-docs.telenordigital.com/img/og_image.jpg" />
  <meta property="og:description" content="Detailed information on authorization and authentication" />
  <meta property="og:site_name" content="CONNECT ID Documentation" />

  <link rel="stylesheet" type="text/css" href="/id-docs.telenordigital.com/style/style.css">
    <link rel="stylesheet" type="text/css" href="/id-docs.telenordigital.com/script/swagger-ui/swagger-ui-docs-preset.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link id="searchIndex" href="/id-docs.telenordigital.com/index.json" rel="preload" as="fetch">
</head>
<body class="docs-body">
  <div id="docs-topbar" class="docs-topbar no-print">
    <div id="docs-topbar__inner" class="docs-topbar__inner">
      <a href="#" id="docs-menu-toggle" class="docs-topbar__icon docs-topbar__icon--menu-toggle hidden-desktop"><i class="material-icons md-24">menu</i></a>
      <a href="#" id="docs-search-hide" class="docs-topbar__icon docs-topbar__icon--search-hide hidden-desktop"><i class="material-icons md-24">arrow_back</i></a>
      <div class="docs-topbar__icon docs-topbar__icon--search visible-desktop"><i class="material-icons md-24">search</i></div>
      <input id="docs-search-box" type="text" class="docs-topbar__search-box" placeholder="Search" tabindex="1" autocapitalize="none" autocomplete="off" autocorrect="off" autofocus />
      <a href="#" id="docs-search-close" class="docs-topbar__icon docs-topbar__icon--search-close"><i class="material-icons md-24">close</i></a>
      <a href="#" id="docs-search-show" class="docs-topbar__icon docs-topbar__icon-search-show hidden-desktop"><i class="material-icons md-24">search</i></a>

          <a class="docs-topbar__link visible-desktop" href="https://github.com/telenordigital/id-docs.telenordigital.com">On Github</a>
    </div>
    <div id="docs-search" class="docs-search">
      <ul id="docs-search-results" class="docs-search-results"></ul>
    </div>
  </div>
  <div id="docs-sidebar" class="docs-sidebar visible-desktop no-print">
    <nav class="docs-nav">
      <a class="docs-nav__logo" href="/id-docs.telenordigital.com/"></a>
        <ul class="docs-nav__ul">
                <li class="docs-nav__li docs-nav__li--category">
                          <span class="docs-nav__item">Get started</span>
                    <ul class="docs-nav__ul">
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/get-started/register-client.html" class="docs-nav__item">Register client</a>
                            </li>
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/get-started/client-registration-details.html" class="docs-nav__item">Required registration details</a>
                            </li>
                    </ul>
                </li>
                <li class="docs-nav__li docs-nav__li--category">
                          <span class="docs-nav__item">What is CONNECT?</span>
                    <ul class="docs-nav__ul">
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/what-is-connect/how-it-works.html" class="docs-nav__item">How it works</a>
                            </li>
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/what-is-connect/single-sign-on.html" class="docs-nav__item">Single sign on</a>
                            </li>
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/what-is-connect/levels-of-assurance.html" class="docs-nav__item">Levels of assurance</a>
                            </li>
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/what-is-connect/account-management.html" class="docs-nav__item">Account management</a>
                            </li>
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/what-is-connect/other-features.html" class="docs-nav__item">Other CONNECT features</a>
                            </li>
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/what-is-connect/ui-examples.html" class="docs-nav__item">UI examples</a>
                            </li>
                    </ul>
                </li>
                <li class="docs-nav__li docs-nav__li--subgroup">
                          <a href="/id-docs.telenordigital.com/general-recommendations.html" class="docs-nav__item">General recommendations</a>
                    <ul class="docs-nav__ul">
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/general-recommendations/integration-sign-in-details.html" class="docs-nav__item">Integration details for handling sign in</a>
                            </li>
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/general-recommendations/session-handling.html" class="docs-nav__item">Session handling</a>
                            </li>
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/general-recommendations/terminology.html" class="docs-nav__item">Terminology/Glossary</a>
                            </li>
                    </ul>
                </li>
                <li class="docs-nav__li docs-nav__li--category">
                          <span class="docs-nav__item">Integrate</span>
                </li>
                <li class="docs-nav__li docs-nav__li--subgroup">
                          <a href="/id-docs.telenordigital.com/integrate-android-sdk.html" class="docs-nav__item">Android SDK integration</a>
                    <ul class="docs-nav__ul">
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/integrate-android-sdk/setup.html" class="docs-nav__item">Setup</a>
                            </li>
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/integrate-android-sdk/sign-in-user.html" class="docs-nav__item">Sign in user</a>
                            </li>
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/integrate-android-sdk/get-access-token.html" class="docs-nav__item">Get a valid access token</a>
                            </li>
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/integrate-android-sdk/access-user-information.html" class="docs-nav__item">Access user information</a>
                            </li>
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/integrate-android-sdk/check-user-state.html" class="docs-nav__item">Check user state</a>
                            </li>
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/integrate-android-sdk/customise-the-user-experience.html" class="docs-nav__item">Customise the user experience</a>
                            </li>
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/integrate-android-sdk/go-to-production.html" class="docs-nav__item">Go to production</a>
                            </li>
                    </ul>
                </li>
                <li class="docs-nav__li docs-nav__li--subgroup">
                          <a href="/id-docs.telenordigital.com/integrate-ios-sdk.html" class="docs-nav__item">iOS SDK integration</a>
                </li>
                <li class="docs-nav__li docs-nav__li--subgroup">
                          <a href="/id-docs.telenordigital.com/integrate-web-app.html" class="docs-nav__item">Web application integration</a>
                </li>
                <li class="docs-nav__li docs-nav__li--category">
                          <span class="docs-nav__item">CONNECT features</span>
                </li>
                <li class="docs-nav__li docs-nav__li--subgroup">
                          <a href="/id-docs.telenordigital.com/authorization-and-authentication.html" class="docs-nav__item">Authorization &amp; authentication</a>
                    <ul class="docs-nav__ul">
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/authorization-and-authentication/scope.html" class="docs-nav__item">Scope</a>
                            </li>
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/authorization-and-authentication/client-security-measures.html" class="docs-nav__item">Client security measures</a>
                            </li>
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/authorization-and-authentication/id-token.html" class="docs-nav__item">ID token</a>
                            </li>
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/authorization-and-authentication/sso.html" class="docs-nav__item">Single sign-on</a>
                            </li>
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/authorization-and-authentication/authorization-examples.html" class="docs-nav__item">Authorization code examples</a>
                            </li>
                    </ul>
                </li>
                <li class="docs-nav__li docs-nav__li--subgroup">
                          <a href="/id-docs.telenordigital.com/user-data.html" class="docs-nav__item">User data</a>
                </li>
                <li class="docs-nav__li docs-nav__li--category">
                          <span class="docs-nav__item">API Reference</span>
                    <ul class="docs-nav__ul">
                            <li class="docs-nav__li">
                                      <a href="/id-docs.telenordigital.com/apireference/authentication.html" class="docs-nav__item">Authentication &amp; authorization</a>
                            </li>
                    </ul>
                </li>
        </ul>
        <div class="docs-sidebar__menuLinks hidden-desktop">
          <hr class="docs-nav__hr" />
          <ul class="docs-nav__ul">
              <li class="docs-nav__li">
                <a href="https://github.com/telenordigital/id-docs.telenordigital.com" class="docs-nav__item">On Github</a>
              </li>
          </ul>
        </div>
    </nav>
  </div>
  <div id="barba-wrapper" class="docs-wrapper">
    <div class="docs-content barba-container">
      <h1>Authorization &amp; authentication</h1>
        <ol class="docs-breadcrumbs tn-breadcrumbs visible-desktop">
                <li class="tn-breadcrumb">
                    <a href="/id-docs.telenordigital.com/">Home</a>
                </li>
            <li class="tn-breadcrumb tn-breadcrumb--active">Authorization &amp; authentication</li>
        </ol>
      <p>A service provider can use CONNECT ID for authenticating users and getting user consent
(authorization) in order to get access to their protected resources.
This will alleviate the need for the service provider to handle end user credentials,
by utilizing our signup processes and login mechanisms.
CONNECT ID supplies this functionality from an authorization server, which is implemented
according to the OAuth 2.0 and OpenID Connect protocols.</p>
<h2 id="protocol-flow">Protocol flow</h2>
<p>OAuth 2.0 and OpenID Connect define four roles:</p>
<ul>
<li><strong>Resource owner</strong> - An entity capable of granting access to a protected resource, typically the end user.</li>
<li><strong>Client</strong> (aka <strong>Relying Party</strong>) - An application making protected resource requests on behalf of the resource owner and with its authorization.</li>
<li><strong>Resource server</strong> - A server hosting protected resources, capable of accepting  and responding to protected resource requests using access tokens.</li>
<li><strong>Authorization server</strong> (aka <strong>OpenID Provider</strong>) - The server issuing access tokens to the client after successfully authenticating the resource owner and obtaining authorization.</li>
</ul>
<p><img src="img/sequencediagrams/abstract_protocol_flow.png" alt="Abstract protocol flow"></p>
<p>The above diagram shows how a client requests and gets an authorization grant from
the resource owner (1 and 2), exchanges the authorization grant for an access token (3 and 4),
and uses the access token to access protected resources (5 and 6).
An authorization grant is a credential representing the resource owner’s authorization to access
its protected resources, which is used by the client to obtain an access token.
An access token is a credential used by the client when accessing protected resources
on resource servers.
The access token provides an abstraction layer and is much better to use than resource owner
credentials directly since it is usually opaque to the client and is typically restricted both
in lifetime and scope, which significantly improves security.</p>
<h2 id="authorization-code-flow">Authorization code flow</h2>
<p>The typical OAuth 2.0 / OpenID Connect flow is the authorization code flow.
In this flow, the client gets an authorization grant in the form of an abstract one-time usage
credential called an authorization code by involving the authorization server in
authenticating and getting authorization from the end user (resource owner).</p>
<p><img src="img/sequencediagrams/authorization_code_flow.png" alt="Authorization code flow"></p>
<p>The above diagram shows that the flow starts with directing the end user’s browser to the
<a href="http://docs.telenordigital.com/apis/connect/id/authentication.html#authorization-server-user-authorization">/authorize</a>
endpoint (1), where they are presented with a login/signup dialog (2).
After the user successfully logs in with their credentials (3) and authorizes access
(4 and 5), an authorization code is returned to the client via a browser redirect (6).
The client uses this authorization code to obtain tokens including the access token via the
<a href="http://docs.telenordigital.com/apis/connect/id/authentication.html#authorization-server-token">/token</a> endpoint (7 and 8).
The client can use the access token to access protected resources on resource servers
as described in the previous section (9).</p>
<h2 id="refresh-token-flow">Refresh token flow</h2>
<p>An access token is for security reasons only valid for a limited amount of time
(in the order of several tenths of minutes).
In order to be able to maintain access for an extended amount of time without repeatedly
having to ask the resource owner for access, the client can use a refresh token to get
a new valid access token.</p>
<p><img src="img/sequencediagrams/refresh_token_flow.png" alt="Refresh token flow"></p>
<p>In the above diagram, a client is using the access token for some time until it expires,
which causes a resource server to return an invalid_token response (6).
When this happens, the client can use the refresh token to get a new valid access and refresh token
(7 and 8), see the <a href="http://docs.telenordigital.com/apis/connect/id/authentication.html#authorization-server-token">/token</a>
endpoint for details about the request.
If the refresh token request fails as well, the client has lost its authorization and needs
to start the process over by requesting a new authorization grant from the resource owner.</p>
<p>In contrast to the access token, the refresh token is only used in communication between
the client and the authorization server, and is therefore less exposed to being compromised,
assuming that the client is able to store and handle refresh (and access) tokens securely.
Since the access token is valid just for a short while, an attacker will only have
a short period of time to crack and use an access token before it expires.</p>
<h2 id="access-token-validation">Access token validation</h2>
<p>For all requests to the end user’s protected resources, the access token must be validated to
ensure that it has not expired and that its scope covers the requested resource, ref
<a href="https://tools.ietf.org/html/rfc6749#section-7">section 7 in the OAuth specification (RFC 6749)</a>.
Since the access tokens issued by CONNECT are so-called bearer tokens,
resource servers should be implemented according to the
<a href="https://tools.ietf.org/html/rfc6750">OAuth bearer token usage specification (RFC 6750)</a>.
All the resource servers provided by CONNECT are implemented according to this and are validating
access tokens, see documentation on <a href="authorization-and-authentication/scope.html">scope values and respective endpoints</a>.</p>
<p>Access to service-specific protected resources must be validated as well.
The best way of doing this is to put those resources on service-specific resource servers
accessible through RESTful calls using the access token as authentication according to
the OAuth bearer token usage specification mentioned above.
An alternative that might make sense for some confidential clients is to combine the client
and resource server into a single application.
If this is done, the access tokens must still be validated for all access to protected resources.
Please note that combining the client and resource servers into one unit might result in
modularisation issues and consequently make it harder to expand the functionality of the client if
such a need arises.</p>
<p>If the service-specific resource servers do not comply with validating access to protected
resources, functionality to revoke access for a client, e.g. when a mobile device for a user has
been stolen, will not work as intended, that is, keep the thief away from confidential data in the
clients.
This is not acceptable from an end user perspective.</p>
<p>Service-specific resource servers should define their own scope values that can be requested by
the clients and validated in the resource servers.
By default, when configuring clients in the authorization server, we will define
a single scope value per service that can and should be used for the purpose of
validating access tokens for service-specific resource servers.
This scope value will only be available for clients belonging to the service in question.
If your service has the need for more than a single service-specific scope value,
e.g. to be able to give access to different sets of resources for different clients,
please let us know, and we can define any number of custom scope values in the authorization server.</p>
<p><img src="img/sequencediagrams/access_token_validation_flow.png" alt="Access token validation flow"></p>
<p>The above diagram shows how a client requests a protected resource from a resource server (1)
by providing the access token as a bearer token in the Authorization header.
The resource server looks up the access token via the
<a href="http://docs.telenordigital.com/apis/connect/id/authentication.html#authorization-server-token-information">/tokeninfo</a> endpoint
(2), and the TokenInfo response (3) is used as a basis for token validation (4).
If the access token is valid and the scope is sufficient, the protected resource is returned (5).
Otherwise, an appropriate error response is returned (6 and 7).</p>
<h2 id="maintaining-a-session-in-the-client">Maintaining a session in the client</h2>
<p>In order to maintain access within the client using access and refresh tokens as described
in the sections above, the client needs to store at least the most recent access and refresh tokens
in a session.
As described in the previous section, the access token needs to be used in all requests to
protected resources.
If a resource server returns an invalid_token response, the access and refresh tokens
can be refreshed using the refresh token stored in the session.</p>
<p>The client may also choose to store the expires_in and scope fields from the token response
for the most recent access token and the time it was received in the session.
If the number of seconds indicated by the expires_in field has passed, the client can consider
refreshing the access token before trying to use it to avoid an unnecessary protected resource call
that will probably end up in an invalid_token response from the resource server.</p>
<p>We also recommend storing the <a href="authorization-and-authentication/id-token.html">ID token</a> in the client-specific session.
The ID token contains useful information about the authentication and the end user which is
relevant for the session.
See examples of how this information can be used in the subsections below.</p>
<h3 id="require-different-level-of-assurance-for-different-parts-of-a-client">Require different level of assurance for different parts of a client</h3>
<p>The ID token contains information about the level of assurance (LoA) achieved in the user login
in the ‘acr’ claim and the client can also request that login should happen on a given LoA with
the ‘acr_values’ parameter for the
<a href="http://docs.telenordigital.com/apis/connect/id/authentication.html#authorization-server-user-authorization">authorization request</a>.</p>
<p>This can be used to protect sensitive functionality in the client by a higher LoA, while still
allowing smooth login on a lower LoA for functionality that is not as sensitive.
For instance, the client may request login on the default LoA (LoA 1) for the initial
authorization request when the client starts interacting with the client.
When the client accesses especially sensitive functionality, the client can check if the current
client-specific session contains an ID token with a high enough LoA, and if not, send
a new authorization request with a higher LoA (e.g. acr_value=2).
This will typically result in the user having to explicitly authenticate once more, but most users
will probably appreciate the extra security required when performing especially sensitive tasks
like changing profile data or performing a payment.</p>
<h3 id="control-the-maximum-age-for-the-authentication">Control the maximum age for the authentication</h3>
<p>The ID token contains two useful timestamps: The time the ID token was issued (the ‘iat’ claim)
and the time of authentication (the ‘auth_time’ claim).
If the ID token was issued based on authentication through <a href="authorization-and-authentication/sso.html">single sign-on (SSO)</a>,
the time of authentication may be a long time before the issued time, while the timestamps
are typically the same if the ID token was issued based on an explicit user authentication.</p>
<p>The client may for security reasons choose to require that the authentication is not older than
a given value.
This can be achieved by checking the ‘auth_time’ claim in the ID token in the session.
The client may also force an authentication rather than automatic login through SSO by using
the ‘max_age’ parameter in the
<a href="http://docs.telenordigital.com/apis/connect/id/authentication.html#authorization-server-user-authorization">authorization request</a>.</p>
<p>Note that on LoA 1, the user might get automatic authentication through header enrichment.
To control this, e.g. turn off header enrichment for certain requests, the client may use
the ‘prompt’ parameter for the
<a href="http://docs.telenordigital.com/apis/connect/id/authentication.html#authorization-server-user-authorization">authorization request</a>.</p>
<p>Controlling the maximum age of the authentication might be especially useful in combination with
requiring higher LoA for sensitive functionality as described in the previous section.</p>
<h2 id="back-channel-logout">Back-channel logout</h2>
<p>Some services might be concerned about their clients having to send a separate request to
the authorization server to <a href="#access-token-validation">validate the access token</a>
for every access to service-specific protected resources.
They might for instance be concerned about the extra latency introduced by the
<a href="http://docs.telenordigital.com/apis/connect/id/authentication.html#authorization-server-token-information">/tokeninfo</a>
request or the sheer number of requests.
Those clients may enable the back-channel logout feature by getting a client callback endpoint
for back-channel logout notifications configured in the authorization server.
Consequently, those clients will get a notification when a user is considered logged out
by the authorization server, rather than having to “poll” the /tokeninfo endpoint to detect
such a situation.
The notification will be in the form of a logout token, and the functionality is implemented
according to the
<a href="https://openid.net/specs/openid-connect-backchannel-1_0.html">OpenID Connect Back-Channel Logout spec</a>.</p>
<p>The logout token is a signed JWT, and just like the ID token, the signature can be validated and
contents can be decoded by passing it to the
<a href="http://docs.telenordigital.com/apis/connect/id/authentication.html#authorization-server-token-information">/tokeninfo</a> endpoint.
Please note that this function is not supposed to be used in production because of
the extra network call.
In production, the client should get and cache the public keys for signing from the
<a href="http://docs.telenordigital.com/apis/connect/id/authentication.html#authorization-server-jwk-set-endpoint">JWK set endpoint</a>
and a JWT library should be used to validate the signature and decode the logout token locally,
see <a href="authorization-and-authentication/id-token.html#id-token-validation">ID token validation</a> for recommendations and links.</p>
<p>The set of claims contained in the logout token also needs to be validated by the client, see the
<a href="https://openid.net/specs/openid-connect-backchannel-1_0.html#Validation">OpenID Connect Back-Channel Logout spec, section 2.6</a>.
Depending on the configuration, the logout token contains enough information to identify either
the session the user is being logged out of (sub and sid claims) or the user being logged out
(just the sub claim).
The client must give a response according to
<a href="http://openid.net/specs/openid-connect-backchannel-1_0.html#BCResponse">OpenID Connect Back-Channel Logout spec, section 2.8</a>.</p>
<p>Note that the back-channel logout functionality is provided on a best-effort basis only, that is,
there are no guarantees that the client will be notified in all cases.
However, if a logout token is for example lost during transmission, the client will eventually
lose access when it tries to send a refresh token request, since the request will fail
because the refresh token has been revoked.</p>
<h2 id="detailed-authorization-code-flow">Detailed authorization code flow</h2>
<p>Below is a detailed authorization code flow diagram for OpenID Connect, which can be used
to get overview of relevant endpoints, parameters, and response data.</p>
<p><img src="img/sequencediagrams/connect_id_openid_flow.png" alt="Open ID Connect flow"></p>
<h2 id="useful-links">Useful links</h2>
<p><a href="http://docs.telenordigital.com/apis/connect/id/authentication.html">CONNECT authentication and authorization API documentation</a>.</p>

      <div class="lesson-nav">
          <a class="next right" href="/id-docs.telenordigital.com/authorization-and-authentication/authorization-examples.html">Authorization code examples &rarr;</a>
      </div>
        <a class="docs-edit-btn no-print" href="https://github.com/TelenorDigital/id-docs.telenordigital.com/edit/master/docs/authorization-and-authentication.md" target="_blank">Edit this page</a>
    </div>
  </div>
    <script src="/id-docs.telenordigital.com/script/swagger-ui/swagger-ui-bundle.js" ></script>
    <script src="/id-docs.telenordigital.com/script/swagger-ui/swagger-ui-docs-preset.js" ></script>
  <script src="/id-docs.telenordigital.com/script/vendor.js" ></script>
  <script src="/id-docs.telenordigital.com/script/script.js" ></script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
</body>
</html>
